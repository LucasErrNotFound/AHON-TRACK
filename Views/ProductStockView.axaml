<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
    xmlns:converters="clr-namespace:AHON_TRACK.Converters"
    xmlns:viewModels="clr-namespace:AHON_TRACK.ViewModels"
    x:DataType="viewModels:ProductStockViewModel"
    mc:Ignorable="d" d:DesignWidth="1683" d:DesignHeight="1080"
    x:Class="AHON_TRACK.Views.ProductStockView">

    <Design.DataContext>
        <viewModels:ProductStockViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <SolidColorBrush x:Key="MutedColor" Color="#2C2F36" Opacity="0.70" />
        <SolidColorBrush x:Key="FontForeground" Color="#2C2F36" />
        <SolidColorBrush x:Key="ForegroundColor" Color="#2C2F36" />

        <SolidColorBrush x:Key="PrimaryColor" Color="#2C2F36" />
        <SolidColorBrush x:Key="PrimaryColor75" Color="#2C2F36" Opacity="0.75" />
        <SolidColorBrush x:Key="PrimaryColor50" Color="#2C2F36" Opacity="0.50" />
        <SolidColorBrush x:Key="PrimaryColor10" Color="#2C2F36" Opacity="0.10" />

        <SolidColorBrush x:Key="SuccessColor" Color="#22C55E" />
        <SolidColorBrush x:Key="SuccessColor60" Color="#22c55e" Opacity="0.6" />
        <SolidColorBrush x:Key="SuccessColor10" Color="#22c55e" Opacity="0.1" />

        <converters:IntToBoolConverter x:Key="IntToBoolConverter" />
        <converters:IntToInverseBoolConverter x:Key="IntToInverseBoolConverter" />
        <converters:DateToStringConverter x:Key="DateToStringConverter" />
    </UserControl.Resources>

    <DockPanel LastChildFill="True">
        <StackPanel
            MaxWidth="{StaticResource PageMaxWidth}"
            Margin="{StaticResource PageMargin}"
            DockPanel.Dock="Top">
            <TextBlock
                FontSize="30"
                FontWeight="SemiBold"
                Text="Product Stock"
                Margin="90,30,0,0" />
            <TextBlock
                Classes="Caption Muted"
                FontSize="14"
                Text="Track product inventory levels and manage restocking"
                TextWrapping="Wrap"
                Margin="90,0" />
        </StackPanel>
        <ScrollViewer HorizontalScrollBarVisibility="Auto">
            <StackPanel MaxWidth="{StaticResource PageMaxWidth}" Margin="90,40,70,24" Spacing="16">
                <shadui:Card MinWidth="300" MaxWidth="1500">
                    <StackPanel>
                        <Grid ColumnDefinitions="Auto Auto Auto *">
                            <TextBox
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Watermark="Search products..."
                                shadui:ControlAssist.ShowProgress="{CompiledBinding IsSearchingProduct}"
                                Text="{CompiledBinding SearchStringResult, Mode=TwoWay}"
                                shadui:ControlAssist.Height="40"
                                Classes="Clearable"
                                Width="400">
                                <TextBox.InnerRightContent>
                                    <Svg
                                        Width="20"
                                        Opacity="0.75"
                                        Path="avares://AHON_TRACK/Assets/ProductStockView/search-icon.svg" />
                                </TextBox.InnerRightContent>
                            </TextBox>
                            <ComboBox
                                Grid.Column="1"
                                Width="150"
                                Margin="20,0,0,0"
                                PlaceholderText="Filter"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                ItemsSource="{CompiledBinding ProductFilterItems}"
                                SelectedItem="{CompiledBinding SelectedProductFilterItem}">
                            </ComboBox>
                            <Button
                                Grid.Column="2"
                                Classes="Outline"
                                Margin="20,0,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Command="{CompiledBinding ExportProductStockCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <Svg
                                        Width="20"
                                        Height="20"
                                        VerticalAlignment="Center"
                                        Margin="0,0,8,0"
                                        Path="avares://AHON_TRACK/Assets/ProductStockView/export-icon.svg" />
                                    <TextBlock Text="Export to PDF" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button
                                Grid.Column="3"
                                Classes="Primary"
                                Margin="20,0,0,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Command="{CompiledBinding ShowAddProductViewCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <Svg
                                        Width="20"
                                        Height="20"
                                        VerticalAlignment="Center"
                                        Margin="0,0,8,0"
                                        Path="avares://AHON_TRACK/Assets/ProductStockView/add-item-icon.svg" />
                                    <TextBlock Text="Add Product" Foreground="White" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </Grid>
                        <DataGrid
                            Height="650"
                            Margin="0,20,0,0"
                            CanUserReorderColumns="False"
                            CanUserSortColumns="False"
                            GridLinesVisibility="All"
                            SelectionMode="Single"
                            HeadersVisibility="Column"
                            ItemsSource="{CompiledBinding ProductItems}"
                            SelectedItem="{CompiledBinding SelectedProduct}"><!-- The Height property should be MaxHeight in the future -->
                            
                            <DataGrid.Styles>
                                <Style Selector="TextBlock">
                                    <Setter Property="TextWrapping" Value="WrapWithOverflow" />
                                </Style>
                            </DataGrid.Styles>

                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Binding="{CompiledBinding IsSelected}" CanUserSort="False" Width="60">
                                    <!--CheckBox Header Column-->
                                    <DataGridCheckBoxColumn.Header>
                                        <CheckBox
                                            x:Name="SelectToggler"
                                            Command="{CompiledBinding ToggleSelectionCommand}"
                                            CommandParameter="{CompiledBinding #SelectToggler.IsChecked}"
                                            IsChecked="{CompiledBinding SelectAll}"
                                            Margin="8,0" />
                                    </DataGridCheckBoxColumn.Header>
                                </DataGridCheckBoxColumn>

                                <!-- Product ID -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="80"
                                    Header="ID"
                                    Binding="{CompiledBinding ID}" />

                                <!-- Product Name -->
                                <DataGridTextColumn
                                    Width="*"
                                    Header="Product Name"
                                    Binding="{CompiledBinding Name}" />
                                
                                <!-- SKU -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="150"
                                    Header="SKU"
                                    Binding="{CompiledBinding Sku}" />

                                <!-- Category -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="160"
                                    Header="Category"
                                    Binding="{CompiledBinding Category}" />

                                <!-- Current Stock -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="100"
                                    Header="Current Stock"
                                    Binding="{CompiledBinding CurrentStock}" />

                                <!-- Price -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="130"
                                    Header="Price"
                                    Binding="{CompiledBinding FormattedPrice}" />

                                <!-- Supplier -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="150"
                                    Header="Supplier"
                                    Binding="{CompiledBinding Supplier}" />
                                
                                <!-- Expiry -->
                                <DataGridTextColumn
                                    Width="Auto"
                                    MinWidth="140"
                                    Header="Expiry"
                                    Binding="{CompiledBinding FormattedExpiry}" />

                                <!-- Status -->
                                <DataGridTemplateColumn
                                    CanUserSort="False"
                                    Header="Status"
                                    Width="170">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="viewModels:ProductStock">
                                            <Border
                                                Background="{CompiledBinding StatusBackground}"
                                                CornerRadius="7"
                                                Padding="8,4"
                                                Margin="5,0,0,0"
                                                HorizontalAlignment="Left">
                                                <TextBlock
                                                    Text="{CompiledBinding StatusDisplayText}"
                                                    Foreground="{CompiledBinding StatusForeground}"
                                                    FontSize="13"
                                                    FontWeight="Medium"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <!-- Action -->
                                <DataGridTemplateColumn CanUserResize="False" CanUserSort="False" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="viewModels:Equipment">
                                            <Menu>
                                                <MenuItem
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Classes="Icon Grid"
                                                    shadui:MenuItemAssist.PopupPlacement="BottomEdgeAlignedRight">
                                                    <MenuItem.Header>
                                                        <Svg
                                                            Width="24"
                                                            Height="24"
                                                            Path="/Assets/ProductStockView/three-dots-icon.svg"/>
                                                    </MenuItem.Header>
                                                    <shadui:MenuItemAssist.Label>
                                                        <TextBlock 
                                                            Text="Actions" 
                                                            FontSize="15" 
                                                            FontWeight="Regular" 
                                                            Foreground="{DynamicResource MutedColor}"/>
                                                    </shadui:MenuItemAssist.Label>
                                                    <MenuItem
                                                        Header="Edit Equipment"
                                                        Command="{CompiledBinding $parent[DataGrid].((viewModels:ProductStockViewModel)DataContext).ShowEditProductViewCommand, FallbackValue={x:Null}}"
                                                        CommandParameter="{CompiledBinding}" />
                                                    <Separator />
                                                    <MenuItem
                                                        Header="Delete"
                                                        Foreground="{DynamicResource DestructiveColor}"
                                                        Command="{CompiledBinding $parent[DataGrid].((viewModels:ProductStockViewModel)DataContext).ShowSingleItemDeletionDialogCommand, FallbackValue={x:Null}}"
                                                        CommandParameter="{CompiledBinding}"
                                                        IsVisible="{CompiledBinding $parent[DataGrid].((viewModels:ProductStockViewModel)DataContext).SelectedCount, Converter={StaticResource IntToInverseBoolConverter}, FallbackValue={x:Null}}"/>
                                                    <MenuItem
                                                        Header="Delete Selected"
                                                        Foreground="{DynamicResource DestructiveColor}"
                                                        Command="{CompiledBinding $parent[DataGrid].((viewModels:ProductStockViewModel)DataContext).ShowMultipleItemDeletionDialogCommand, FallbackValue={x:Null}}"
                                                        CommandParameter="{CompiledBinding}"
                                                        IsVisible="{CompiledBinding $parent[DataGrid].((viewModels:ProductStockViewModel)DataContext).SelectedCount, Converter={StaticResource IntToBoolConverter}, FallbackValue={x:Null}}" />
                                                </MenuItem>
                                            </Menu>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </shadui:Card>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>